Index: includes/parser/Parser.php
===================================================================
--- includes/parser/Parser.php
+++ includes/parser/Parser.php
@@ -3682,6 +3682,10 @@ class Parser
 
 			# Don't number the heading if it is the only one (looks silly)
 			if( $doNumberHeadings && count( $matches[3] ) > 1) {
+				# Bug 54239 - Ссылки на разделы с нумерацией
+				if (!$headNumberReplacer)
+					$headNumberReplacer = new ReplacementArray();
+				$headNumberReplacer->setPair('>'.trim($headline).'</a>', '>'.$numbering.' '.trim($headline).'</a>');
 				# the two are different if the line contains a link
 				$headline=$numbering . ' ' . $headline;
 			}
@@ -3732,6 +3736,10 @@ class Parser
 			$toc = $sk->tocList( $toc );
 		}
 
+		# Bug 54239 - Ссылки на разделы с нумерацией
+		if ($headNumberReplacer)
+			$text = $headNumberReplacer->replace($text);
+
 		# split up and insert constructed headlines
 
 		$blocks = preg_split( '/<H[1-6].*?' . '>.*?<\/H[1-6]>/i', $text );
