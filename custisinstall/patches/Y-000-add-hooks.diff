# HG changeset patch
# User Vitaliy Filippov <vitali@st-filippov.office.custis.ru>
# Date 1291735922 -10800
Bug 63447, add hook for MediaWiki::preliminaryChecks()
Bug 71769, add hook for overriding grouping values for enhanced recent changes view

diff -r 2951a613ce57 -r ca2a932b855a extensions/PdfHandler/PdfHandler_body.php
--- extensions/PdfHandler/PdfHandler_body.php
+++ extensions/PdfHandler/PdfHandler_body.php
@@ -113,7 +113,7 @@
 		if ( !wfMkdirParents( dirname( $dstPath ) ) )
 			return $this->doThumbError( $width, $height, 'thumbnail_dest_directory' );
 
-		$cmd = '(' . wfEscapeShellArg( $wgPdfProcessor );
+		$cmd = '(' . $wgPdfProcessor;
 		$cmd .= " -sDEVICE=jpeg -sOutputFile=- -dFirstPage={$page} -dLastPage={$page}";
 		$cmd .= " -r{$wgPdfHandlerDpi} -dBATCH -dNOPAUSE -q ". wfEscapeShellArg( $srcPath );
 		$cmd .= " | " . wfEscapeShellArg( $wgPdfPostProcessor );
diff -r 2951a613ce57 -r ca2a932b855a includes/ChangesList.php
--- includes/ChangesList.php
+++ includes/ChangesList.php
@@ -552,6 +552,7 @@
 			if( $rc_type == RC_LOG ){
 				$secureName = SpecialPage::getTitleFor( 'Log', $rc_log_type )->getPrefixedDBkey();
 			}
+			wfRunHooks( 'EnhancedChangesListGroupBy', array( &$rc, &$title, &$secureName ) );
 			if( !isset( $this->rc_cache[$secureName] ) ) {
 				$this->rc_cache[$secureName] = array();
 			}
diff -r 2951a613ce57 -r ca2a932b855a includes/Wiki.php
--- includes/Wiki.php
+++ includes/Wiki.php
@@ -142,6 +142,8 @@
 			// Do this above the read whitelist check for security...
 			$title = SpecialPage::getTitleFor( 'Search' );
 		}
+		if ( !wfRunHooks( 'MediaWikiPreliminaryChecks', array( &$title, &$output, $request ) ) )
+			return false;
 		# If the user is not logged in, the Namespace:title of the article must be in
 		# the Read array in order for the user to see it. (We have to check here to
 		# catch special pages etc. We check again in Article::view())
