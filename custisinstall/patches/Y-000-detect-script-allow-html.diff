# HG changeset patch
# User Vitaliy Filippov <vitali@st-filippov.office.custis.ru>
# Date 1300730052 -10800
Bug 55101 - Allow some html in uploads (for SVG)
Bug 75888 - Correct message parameters

diff -r 9cc4b1960d33 -r 1dd53fd9b424 includes/upload/UploadBase.php
--- includes/upload/UploadBase.php
+++ includes/upload/UploadBase.php
@@ -338,7 +338,7 @@
 		global $wgCheckFileExtensions, $wgFileExtensions;
 		if ( $wgCheckFileExtensions ) {
 			if ( !$this->checkFileExtension( $this->mFinalExtension, $wgFileExtensions ) ) {
-				$warnings['filetype-unwanted-type'] = $this->mFinalExtension;
+				$warnings['filetype-unwanted-type'] = array( $this->mFinalExtension, implode( ', ', $wgFileExtensions ) );
 			}
 		}
 
@@ -646,7 +646,7 @@
 	 * @return bool true if the file contains something looking like embedded scripts
 	 */
 	public static function detectScript( $file, $mime, $extension ) {
-		global $wgAllowTitlesInSVG;
+		global $wgAllowTitlesInSVG, $wgForbiddenTagsInUploads;
 
 		# ugly hack: for text files, always look at the entire file.
 		# For binary field, just check the first K.
@@ -703,16 +703,18 @@
 		 * Also returns true if Safari would mistake the given file for HTML
 		 * when served with a generic content-type.
 		 */
-		$tags = array(
-			'<a href',
-			'<body',
-			'<head',
-			'<html',   #also in safari
-			'<img',
-			'<pre',
-			'<script', #also in safari
-			'<table'
-		);
+		$tags = $wgForbiddenTagsInUploads;
+		if ( !$tags )
+			$tags = array(
+				'<a href',
+				'<body',
+				'<head',
+				'<html',   #also in safari
+				'<img',
+				'<pre',
+				'<script', #also in safari
+				'<table'
+			);
 
 		if( !$wgAllowTitlesInSVG && $extension !== 'svg' && $mime !== 'image/svg' ) {
 			$tags[] = '<title';
