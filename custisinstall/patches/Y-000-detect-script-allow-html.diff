# HG changeset patch
# User Vitaliy Filippov <vitalif@yourcmc.ru>
# Date 1327949007 -14400
Bug 55101 - Allow some html in uploads (for SVG)
Bug 75888 - Correct message parameters

diff -r 6b6371ec1416 -r 1b4839f5e663 includes/upload/UploadBase.php
--- includes/upload/UploadBase.php
+++ includes/upload/UploadBase.php
@@ -877,7 +877,7 @@
 	 * @return Boolean: true if the file contains something looking like embedded scripts
 	 */
 	public static function detectScript( $file, $mime, $extension ) {
-		global $wgAllowTitlesInSVG;
+		global $wgAllowTitlesInSVG, $wgForbiddenTagsInUploads;
 
 		# ugly hack: for text files, always look at the entire file.
 		# For binary field, just check the first K.
@@ -934,16 +934,18 @@
 		 * Also returns true if Safari would mistake the given file for HTML
 		 * when served with a generic content-type.
 		 */
-		$tags = array(
-			'<a href',
-			'<body',
-			'<head',
-			'<html',   #also in safari
-			'<img',
-			'<pre',
-			'<script', #also in safari
-			'<table'
-		);
+		$tags = $wgForbiddenTagsInUploads;
+		if ( !$tags )
+			$tags = array(
+				'<a href',
+				'<body',
+				'<head',
+				'<html',   #also in safari
+				'<img',
+				'<pre',
+				'<script', #also in safari
+				'<table'
+			);
 
 		if( !$wgAllowTitlesInSVG && $extension !== 'svg' && $mime !== 'image/svg' ) {
 			$tags[] = '<title';
