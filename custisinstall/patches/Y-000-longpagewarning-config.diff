# HG changeset patch
# User Vitaliy Filippov <vitali@st-filippov.office.custis.ru>
# Date 1300894197 -10800
Bug 75757 - Allow to configure longpagewarning article size limit

diff -r 9cc4b1960d33 -r 09f21e04dcfd includes/DefaultSettings.php
--- includes/DefaultSettings.php
+++ includes/DefaultSettings.php
@@ -1125,6 +1125,7 @@
 $wgShowIPinHeader	= true; # For non-logged in users
 $wgMaxSigChars		= 255;  # Maximum number of Unicode characters in signature
 $wgMaxArticleSize	= 2048; # Maximum article size in kilobytes
+$wgWarnArticleSize	= 128;  # Article size in kilobytes to show MediaWiki:Longpagewarning
 # Maximum number of bytes in username. You want to run the maintenance
 # script ./maintenancecheckUsernames.php once you have changed this value
 $wgMaxNameChars		= 255;
diff -r 9cc4b1960d33 -r 09f21e04dcfd includes/EditPage.php
--- includes/EditPage.php
+++ includes/EditPage.php
@@ -1329,6 +1329,7 @@
 	
 	protected function showHeader() {
 		global $wgOut, $wgUser, $wgTitle, $wgMaxArticleSize, $wgLang;
+		global $wgWarnArticleSize;
 		if ( $this->isConflict ) {
 			$wgOut->wrapWikiMsg( "<div class='mw-explainconflict'>\n$1</div>", 'explainconflict' );
 			$this->edittime = $this->mArticle->getTimestamp();
@@ -1450,9 +1451,9 @@
 			$wgOut->addHTML( "<div class='error' id='mw-edit-longpageerror'>\n" );
 			$wgOut->addWikiMsg( 'longpageerror', $wgLang->formatNum( $this->kblength ), $wgLang->formatNum( $wgMaxArticleSize ) );
 			$wgOut->addHTML( "</div>\n" );
-		} elseif ( $this->kblength > 29 ) {
+		} elseif ( $wgWarnArticleSize !== NULL && $this->kblength > $wgWarnArticleSize ) {
 			$wgOut->addHTML( "<div id='mw-edit-longpagewarning'>\n" );
-			$wgOut->addWikiMsg( 'longpagewarning', $wgLang->formatNum( $this->kblength ) );
+			$wgOut->addWikiMsg( 'longpagewarning', $wgLang->formatNum( $this->kblength ), $wgLang->formatNum( $wgWarnArticleSize ) );
 			$wgOut->addHTML( "</div>\n" );
 		}
 	}
diff -r 9cc4b1960d33 -r 09f21e04dcfd languages/messages/MessagesEn.php
--- languages/messages/MessagesEn.php
+++ languages/messages/MessagesEn.php
@@ -1322,7 +1322,7 @@
 '''Do not submit copyrighted work without permission!'''",
 'editpage-tos-summary'             => '-', # do not translate or duplicate this message to other languages
 'longpagewarning'                  => "'''Warning:''' This page is $1 kilobytes long;
-some browsers may have problems editing pages approaching or longer than 32kb.
+The reasonable maximum for article size is $2 KB.
 Please consider breaking the page into smaller sections.",
 'longpageerror'                    => "'''Error: The text you have submitted is $1 kilobytes long, which is longer than the maximum of $2 kilobytes.'''
 It cannot be saved.",
diff -r 9cc4b1960d33 -r 09f21e04dcfd languages/messages/MessagesRu.php
--- languages/messages/MessagesRu.php
+++ languages/messages/MessagesRu.php
@@ -921,7 +921,7 @@
 Вы также подтверждаете, что являетесь автором вносимых дополнений, или скопировали их из источника, допускающего свободное распространение и изменение своего содержимого (см. $1).
 '''НЕ РАЗМЕЩАЙТЕ БЕЗ РАЗРЕШЕНИЯ ОХРАНЯЕМЫЕ АВТОРСКИМ ПРАВОМ МАТЕРИАЛЫ!'''",
 'longpagewarning'                  => "'''ПРЕДУПРЕЖДЕНИЕ: Длина этой страницы составляет $1 килобайт.
-Страницы, размер которых приближается к 32 КБ или превышает это значение, могут неверно отображаться в некоторых браузерах.
+Максимальный разумный размер страницы установлен равным $2 КБ.
 Пожалуйста, рассмотрите вариант разбиения страницы на меньшие части.'''",
 'longpageerror'                    => "'''ОШИБКА: записываемый вами текст имеет размер $1 килобайт, что больше, чем установленный предел $2 килобайт. Страница не может быть сохранена.'''",
 'readonlywarning'                  => "'''ПРЕДУПРЕЖДЕНИЕ. База данных заблокирована в связи с процедурами обслуживания, поэтому вы не можете записать ваши изменения прямо сейчас.
