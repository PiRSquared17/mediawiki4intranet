# HG changeset patch
# User Vitaliy Filippov <vitalif@yourcmc.ru>
# Date 1303136800 -14400
Bug 68935 - Add lost urlencode and urldecode functions to ParserFunctions

diff -r 45da8fc662c9 -r 7ed22a2d725a extensions/ParserFunctions/ParserFunctions.i18n.magic.php
--- extensions/ParserFunctions/ParserFunctions.i18n.magic.php
+++ extensions/ParserFunctions/ParserFunctions.i18n.magic.php
@@ -25,6 +25,8 @@
 	'count'      => array( 0, 'count' ),
 	'replace'    => array( 0, 'replace' ),
 	'explode'    => array( 0, 'explode' ),
+	'urlencode'  => array( 0, 'urlencode' ),
+	'urldecode'  => array( 0, 'urldecode' ),
 );
 
 $magicWords['ar'] = array(
diff -r 45da8fc662c9 -r 7ed22a2d725a extensions/ParserFunctions/ParserFunctions.php
--- extensions/ParserFunctions/ParserFunctions.php
+++ extensions/ParserFunctions/ParserFunctions.php
@@ -100,6 +100,8 @@
 			$parser->setFunctionHook( 'count',    array(&$this, 'runCount'    ));
 			$parser->setFunctionHook( 'replace',  array(&$this, 'runReplace'  ));
 			$parser->setFunctionHook( 'explode',  array(&$this, 'runExplode'  ));
+			$parser->setFunctionHook( 'urlencode', array(&$this, 'runUrlencode'  ));
+			$parser->setFunctionHook( 'urldecode', array(&$this, 'runUrldecode'  ));
 		}
 
 		return true;
diff -r 45da8fc662c9 -r 7ed22a2d725a extensions/ParserFunctions/ParserFunctions_body.php
--- extensions/ParserFunctions/ParserFunctions_body.php
+++ extensions/ParserFunctions/ParserFunctions_body.php
@@ -764,4 +764,46 @@
 		wfProfileOut( __METHOD__ );
 		return $result;
 	}
+
+	/**
+	 * {{#urlencode:string}}
+	 *
+	 * URL-encode string.
+	 */
+	function runUrlencode ( &$parser, $inStr = '' ) {
+		wfProfileIn( __METHOD__ );
+
+		$inStr = $this->killMarkers( $parser, (string)$inStr );
+
+		if( !$this->checkLength( $inStr ) ) {
+			wfProfileOut( __METHOD__ );
+			return $this->tooLongError();
+		}
+
+		$result = urlencode( $inStr );
+
+		wfProfileOut( __METHOD__ );
+		return $result;
+	}
+
+	/**
+	 * {{#urldecode:string}}
+	 *
+	 * URL-decode string.
+	 */
+	function runUrldecode ( &$parser, $inStr = '' ) {
+		wfProfileIn( __METHOD__ );
+
+		$inStr = $this->killMarkers( $parser, (string)$inStr );
+
+		if( !$this->checkLength( $inStr ) ) {
+			wfProfileOut( __METHOD__ );
+			return $this->tooLongError();
+		}
+
+		$result = urldecode( $inStr );
+
+		wfProfileOut( __METHOD__ );
+		return $result;
+	}
 }
