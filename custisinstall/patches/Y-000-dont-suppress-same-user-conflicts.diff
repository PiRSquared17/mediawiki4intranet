# HG changeset patch
# User Vitaliy Filippov <vitalif@yourcmc.ru>
# Date 1327949123 -14400
Bug 61871 - Allow (optional) article merging for SAME user

diff -r 6b6371ec1416 -r 4a24a8cdfb85 includes/EditPage.php
--- includes/EditPage.php
+++ includes/EditPage.php
@@ -868,6 +868,7 @@
 	function internalAttemptSave( &$result, $bot = false ) {
 		global $wgFilterCallback, $wgUser, $wgParser;
 		global $wgMaxArticleSize;
+		global $wgSuppressSameUserConflicts;
 		
 		$status = Status::newGood();
 
@@ -1077,7 +1078,7 @@
 			$userid = $wgUser->getId();
 
 			# Suppress edit conflict with self, except for section edits where merging is required.
-			if ( $this->isConflict && $this->section == '' && $this->userWasLastToEdit( $userid, $this->edittime ) ) {
+			if ( $wgSuppressSameUserConflicts && $this->isConflict && $this->section == '' && $this->userWasLastToEdit( $userid, $this->edittime ) ) {
 				wfDebug( __METHOD__ . ": Suppressing edit conflict, same user.\n" );
 				$this->isConflict = false;
 			}
@@ -2323,14 +2324,9 @@
 		$currentText = $currentRevision->getText();
 
 		$result = '';
-		if ( wfMerge( $baseText, $editText, $currentText, $result ) ) {
-			$editText = $result;
-			wfProfileOut( __METHOD__ );
-			return true;
-		} else {
-			wfProfileOut( __METHOD__ );
-			return false;
-		}
+		$conflict = wfMerge( $baseText, $editText, $currentText, $editText );
+		wfProfileOut( __METHOD__ );
+		return $conflict;
 	}
 
 	/**
