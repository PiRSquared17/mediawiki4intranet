# HG changeset patch
# User Vitaliy Filippov <vitalif@yourcmc.ru>
# Date 1305305665 -14400
Bug 61871 - Allow (optional) article merging for SAME user

diff -r 45da8fc662c9 -r f258cfeb5090 includes/EditPage.php
--- includes/EditPage.php
+++ includes/EditPage.php
@@ -758,6 +758,7 @@
 	function internalAttemptSave( &$result, $bot = false ) {
 		global $wgFilterCallback, $wgUser, $wgOut, $wgParser;
 		global $wgMaxArticleSize;
+		global $wgSuppressSameUserConflicts;
 
 		wfProfileIn( __METHOD__  );
 		wfProfileIn( __METHOD__ . '-checks' );
@@ -929,7 +930,7 @@
 		$userid = $wgUser->getId();
 
 		# Suppress edit conflict with self, except for section edits where merging is required.
-		if ( $this->isConflict && $this->section == '' && $this->userWasLastToEdit( $userid, $this->edittime ) ) {
+		if ( $wgSuppressSameUserConflicts && $this->isConflict && $this->section == '' && $this->userWasLastToEdit( $userid, $this->edittime ) ) {
 			wfDebug( __METHOD__ . ": Suppressing edit conflict, same user.\n" );
 			$this->isConflict = false;
 		}
@@ -2034,14 +2035,9 @@
 		$currentText = $currentRevision->getText();
 
 		$result = '';
-		if ( wfMerge( $baseText, $editText, $currentText, $result ) ) {
-			$editText = $result;
-			wfProfileOut( __METHOD__ );
-			return true;
-		} else {
-			wfProfileOut( __METHOD__ );
-			return false;
-		}
+		$conflict = wfMerge( $baseText, $editText, $currentText, $editText );
+		wfProfileOut( __METHOD__ );
+		return $conflict;
 	}
 
 	/**
